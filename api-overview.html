

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.1. Overview &mdash; Keypirinha 2.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Keypirinha 2.0.0 documentation" href="index.html"/>
        <link rel="up" title="7. Extending Keypirinha (API)" href="api.html"/>
        <link rel="next" title="7.2. API Reference" href="api-reference.html"/>
        <link rel="prev" title="7. Extending Keypirinha (API)" href="api.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Keypirinha
          

          
            
            <img src="_static/app-128.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="first.html">2. First steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">3. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">4. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="packages.html">5. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="shippacks.html">6. Shipped Packages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api.html">7. Extending <em>Keypirinha</em> (API)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">7.1. Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#threading">7.1.1. Threading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plugin-lifecycle-overview">7.1.2. Plugin Lifecycle overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#loading">7.1.2.1. Loading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reloading">7.1.2.2. Reloading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instanceid">7.1.2.3. InstanceID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#messages-workflow">7.1.2.4. Messages Workflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#getting-started">7.1.3. Getting started</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api-reference.html">7.2. API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="api-python.html">7.3. Embedded Python Interpreter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">8. Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">10. Frequently Asked Questions (FAQ)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Keypirinha</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="api.html">7. Extending <em>Keypirinha</em> (API)</a> &raquo;</li>
      
    <li>7.1. Overview</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1>7.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="threading">
<h2>7.1.1. Threading<a class="headerlink" href="#threading" title="Permalink to this headline">¶</a></h2>
<p><em>Keypirinha</em> is a multi-threaded application and plugins methods are called in an
asynchronous fashion. While the exposed API is thread-safe, plugin developer
should keep in mind that application <strong>and</strong> plugin state may change while her
code is running.</p>
</div>
<div class="section" id="plugin-lifecycle-overview">
<h2>7.1.2. Plugin Lifecycle overview<a class="headerlink" href="#plugin-lifecycle-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="loading">
<span id="api-overview-loading"></span><h3>7.1.2.1. Loading<a class="headerlink" href="#loading" title="Permalink to this headline">¶</a></h3>
<p>When the application starts, it loads the embedded <a class="reference external" href="https://python.org">Python</a> interpreter and
builds a list of the available <a class="reference internal" href="glossary.html#term-packages"><span class="xref std std-term">packages</span></a>, omitting the ones that are
flagged as <em>disabled</em> by the configuration.</p>
<p>Once the list of valid packages is built, <em>Keypirinha</em> scans their files and look
for <code class="file docutils literal"><span class="pre">*.py</span></code> scripts. Each one of those scripts is loaded through the Python
interpreter and the application performs some introspection to list all the
classes derived from <a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin" title="keypirinha.Plugin"><code class="xref py py-class docutils literal"><span class="pre">keypirinha.Plugin</span></code></a> and instantiates them.</p>
<p>The application then calls the <a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin.on_catalog" title="keypirinha.Plugin.on_catalog"><code class="xref py py-meth docutils literal"><span class="pre">keypirinha.Plugin.on_catalog()</span></code></a> method of
every loaded plugin.</p>
</div>
<div class="section" id="reloading">
<h3>7.1.2.2. Reloading<a class="headerlink" href="#reloading" title="Permalink to this headline">¶</a></h3>
<p><em>Keypirinha</em> monitors the <a class="reference internal" href="packages.html#pack-live"><span>Live Packages (Loose)</span></a> directory to detect any change made to
<strong>any</strong> (i.e.: not only the <code class="file docutils literal"><span class="pre">*.py</span></code> scripts) of the loaded packages&#8217; files.</p>
<p>If a modification is detected, and unless it concerns only <code class="file docutils literal"><span class="pre">*.ini</span></code> file(s)
(in which case <a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin.on_config_changed" title="keypirinha.Plugin.on_config_changed"><code class="xref py py-meth docutils literal"><span class="pre">keypirinha.Plugin.on_config_changed()</span></code></a> is called), the
concerned package will be reloaded.</p>
<p>At the beginning of the reloading process, the entire package is first unloaded
from the application including its resources and associated items. Also, Python
is asked to destroy as much references as possible that link to the concerned
Plugins.</p>
<p>It becomes tricky. By design, it is not possible to ensure that any Python
object is totally unloaded and that its memory freed. Being it a module or a
class instance. Python implements a Garbage Collector to manage its memory
allocations and some reference to an object might still exist, after a module
has been unloaded, due to inter-dependencies for example. While this works just
fine most of the time, race conditions may sometimes occur when, for example,
the code of a plugin is running while the application tries to unload it.</p>
<p>To avoid that and to be as flexible as possible, <em>Keypirinha</em> will never force a
particular plugin, or more generally a thread, to terminate. Instead, it offers
to the Plugins a very cheap API call
<a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin.should_terminate" title="keypirinha.Plugin.should_terminate"><code class="xref py py-meth docutils literal"><span class="pre">keypirinha.Plugin.should_terminate()</span></code></a>, that allows Plugins to frequently
check if they should stop any work and leave the current call.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is up to the plugin developer to call the
<a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin.should_terminate" title="keypirinha.Plugin.should_terminate"><code class="xref py py-meth docutils literal"><span class="pre">keypirinha.Plugin.should_terminate()</span></code></a> method as <strong>frequently as
possible</strong> to check if the current call should be interrupted immediately.
Especially at <strong>I/O boundaries</strong> like file operation, directories scanning,
network requests, etc...</p>
</div>
<p>To synthesize, it is technically possible that several instances of a same
plugin coexist. In that case, <em>Keypirinha</em> will <strong>always</strong> use and communicate with
the <strong>last loaded</strong> instance. To differentiate several instances of a Plugin,
<em>Keypirinha</em> internally gives an incremented ID number to every loaded instance of
a Package and its plugins.</p>
</div>
<div class="section" id="instanceid">
<h3>7.1.2.3. InstanceID<a class="headerlink" href="#instanceid" title="Permalink to this headline">¶</a></h3>
<p>The InstanceID is an unsigned integer internally created and managed by the
application, assigned at runtime to every loaded package and plugin. It is
essentially used to ensure plugins are not messing up the <a class="reference internal" href="glossary.html#term-catalog"><span class="xref std std-term">catalog</span></a>.</p>
<p>When a package is loaded for the first time, it receives the InstanceID <code class="docutils literal"><span class="pre">1</span></code>,
as well as its plugins. When any change is detected in one or several of its
files, the package is reloaded and its InstanceID is incremented.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By extension, every <a class="reference internal" href="glossary.html#term-plugin"><span class="xref std std-term">plugin</span></a> of a package receives the InstanceID of
its parent package when it is loaded or reloaded.</p>
</div>
</div>
<div class="section" id="messages-workflow">
<span id="api-overview-msgflow"></span><h3>7.1.2.4. Messages Workflow<a class="headerlink" href="#messages-workflow" title="Permalink to this headline">¶</a></h3>
<p><em>Keypirinha</em> sends <em>messages</em> to its plugins either to notify them about a specific
event, or to request them to perform a specific task.</p>
<p>Once a plugin is loaded, its <a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin.on_catalog" title="keypirinha.Plugin.on_catalog"><code class="xref py py-meth docutils literal"><span class="pre">keypirinha.Plugin.on_catalog()</span></code></a> method is
called.</p>
<p>When the user starts typing its search and each time her search terms have
changed, the <a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin.on_suggest" title="keypirinha.Plugin.on_suggest"><code class="xref py py-meth docutils literal"><span class="pre">keypirinha.Plugin.on_suggest()</span></code></a> method is. There is a
subtlety here. This message is broadcasted when the user hasn&#8217;t selected an item
yet. But once she did, the message will be sent only to the plugin that created
the selected item.</p>
<p>When the user wants to execute the selected item, the
<a class="reference internal" href="api-class-plugin.html#keypirinha.Plugin.on_execute" title="keypirinha.Plugin.on_execute"><code class="xref py py-meth docutils literal"><span class="pre">keypirinha.Plugin.on_execute()</span></code></a> method of the appropriate plugin is
called and it is up to it to actually execute the passed item.</p>
<p>These are the 3 main messages that a plugin developer normally wants to
implement. Other messages are mainly notifications that helps plugin to be
up-to-date with user&#8217;s settings and environment.</p>
</div>
</div>
<div class="section" id="getting-started">
<h2>7.1.3. Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Plugin development should be done in the <a class="reference internal" href="packages.html#pack-live"><span>Live Packages (Loose)</span></a> directory.</p>
<p>The best way to get your hands in the dirt is to use the <code class="docutils literal"><span class="pre">Test</span></code> package as a
new package skeleton, then take a look at the source code of the official
plugins.</p>
<p>In particular:</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">Apps</span></code> package shows how to use <em>Keypirinha</em>&#8216;s API to scan directories and
files.</li>
<li>The <code class="docutils literal"><span class="pre">TaskSwitcher</span></code> and <code class="docutils literal"><span class="pre">Winamp</span></code> packages interact with the Win32 API via
the <a class="reference external" href="https://docs.python.org/3.5/library/ctypes.html#module-ctypes" title="(in Python v3.5)"><code class="xref py py-mod docutils literal"><span class="pre">ctypes</span></code></a> Python standard module.</li>
<li>The <code class="docutils literal"><span class="pre">ControlPanel</span></code> and <code class="docutils literal"><span class="pre">PuTTY</span></code> packages show how to dig into system&#8217;s
Registry using the <a class="reference external" href="https://docs.python.org/3.5/library/winreg.html#module-winreg" title="(in Python v3.5)"><code class="xref py py-mod docutils literal"><span class="pre">winreg</span></code></a> Python standard module.</li>
<li>The <code class="docutils literal"><span class="pre">Calc</span></code> package imports a third-party bundled Python module.</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api-reference.html" class="btn btn-neutral float-right" title="7.2. API Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api.html" class="btn btn-neutral" title="7. Extending Keypirinha (API)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2016, Jean-Charles Lefebvre.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>